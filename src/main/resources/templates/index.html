<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Relatórios UTFPR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Seu CSS existente aqui... */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 2em; background-color: #f8f9fa; color: #212529; }
        .container { max-width: 960px; margin: auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #343a40; border-bottom: 2px solid #dee2e6; padding-bottom: 0.5em; margin-bottom: 1em; }
        .section { margin-bottom: 1.5em; }
        .section-divider { border-top: 1px solid #dee2e6; margin: 2em 0; }
        .form-row { display: flex; gap: 1.5em; align-items: flex-start; }
        .form-group { margin-bottom: 1.5em; flex: 1; }
        label { display: block; margin-bottom: 0.5em; font-weight: 600; }
        select, input[type="file"], input[type="text"], input[type="url"], textarea { width: 100%; padding: 0.7em; border-radius: 4px; border: 1px solid #ced4da; box-sizing: border-box; transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; }
        select:focus, input:focus, textarea:focus { border-color: #80bdff; outline: 0; box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25); }
        textarea { resize: vertical; min-height: 100px; }
        .btn { background-color: #007bff; color: white; padding: 0.8em 1.5em; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; text-align: center; display: inline-block; }
        .btn:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; }
        .btn-secondary:hover { background-color: #5a6268; }

        /* Ajuste aqui para centralizar verticalmente */
        #instructions-box {
            margin-top: 1em;
            padding: 1em;
            background: #e9ecef;
            border-left: 5px solid #007bff;
            border-radius: 4px;
            display: flex;
            align-items: center; /* Alterado de flex-start para center */
            gap: 1em;
        }
        #instructions-box .icon {
            font-size: 2em;
            color: #007bff;
            /* padding-top removido para um alinhamento perfeito pelo flexbox */
        }
        #instructions-box pre { flex: 1; white-space: pre-wrap; word-wrap: break-word; font-family: "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; margin: 0; }

        #required-fields-box { background-color: #f0f8ff; border: 1px solid #bde0fe; padding: 1em; border-radius: 5px; font-size: 0.9em; }
        #required-fields-box h4 { margin-top: 0; }
        .alert { padding: 1em; margin-bottom: 1em; border-radius: 4px; border: 1px solid transparent; }
        .alert-danger { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .alert-success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .footer-actions { display: flex; justify-content: space-between; align-items: center; }
        .checkbox-group { display: flex; align-items: center; gap: 0.5em; }
    </style>
</head>
<body>
<div class="container">
    <h1>Gerador de Relatórios</h1>

    <div id="message-container">
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    </div>

    <form th:action="@{/generate-report}" method="post" enctype="multipart/form-data">
        <div class="section">
            <div class="form-row">
                <div class="form-group">
                    <label for="selectionProcess">Processo Seletivo (Contexto):</label>
                    <select id="selectionProcess" name="selectionProcess">
                        <option th:each="process : ${selectionProcesses}" th:value="${process}" th:text="${process}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportType">Tipo de Relatório:</label>
                    <select id="reportType" name="reportType">
                        <option th:each="type : ${reportTypes}"
                                th:value="${type.name()}"
                                th:text="${type.getDisplayName()}"
                                th:data-instructions="${type.getInstructions()}"
                                th:data-required-headers="${#strings.listJoin(type.getRequiredHeaders(), ';')}"
                                th:data-default-title-template="${type.getDefaultTitleTemplate()}"
                                th:data-default-subtitle="${type.getDefaultSubtitle()}"
                                th:data-default-explanation="${type.getDefaultExplanation()}"
                                th:data-default-qr-code-url="${type.getDefaultQrCodeUrl()}"
                                th:data-default-footer-text="${type.getDefaultFooterText()}">
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="imageSet">Tema Visual do Relatório:</label>
                    <select id="imageSet" name="imageSetId" required>
                        <option value="" disabled selected>-- Escolha um tema --</option>
                        <option th:each="set : ${imageSets}"
                                th:value="${set.id()}"
                                th:text="${set.displayName()}">
                        </option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div id="required-fields-box" class="form-group">
                    <h4>Campos Obrigatórios no CSV:</h4>
                    <ul id="required-fields-list"></ul>
                </div>
            </div>
        </div>

        <div class="section">
            <div id="instructions-box">
                <i class="fas fa-info-circle icon"></i>
                <div style="flex: 1; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
                    <p style="margin: 0 0 1em 0; white-space: normal; font-size: 1em;">
                        1. Acesse o <a href="https://sistemas2.utfpr.edu.br/ords/f?p=106" target="_blank" rel="noopener noreferrer">sistema de onboarding</a> -> Selecione Relatórios -> e depois escolhe o tipo de relatório.
                    </p>
                    <pre id="instructions-text" style="margin: 0;"></pre>
                </div>
            </div>
        </div>

        <hr class="section-divider">

        <div class="section">
            <div class="form-group">
                <label for="reportTitle">Título do Relatório:</label>
                <input type="text" id="reportTitle" name="reportTitle" placeholder="Ex: RELAÇÃO DE CANDIDATOS CONVOCADOS" required>
            </div>
            <div class="form-group">
                <label for="reportSubtitle">Subtítulo do Relatório (Edital):</label>
                <textarea id="reportSubtitle" name="reportSubtitle" rows="2" placeholder="Ex: EDITAL 12/2025 - PROGRAD, PROCESSO SELETIVO..." required></textarea>
            </div>
            <div class="form-group">
                <label for="explanationText">Explicação do Relatório (aceita HTML):</label>
                <textarea id="explanationText" name="explanationText" rows="4" placeholder="Ex: <b>Prezados candidatos</b>, sigam as orientações abaixo..."></textarea>
            </div>

        </div>

        <hr class="section-divider">

        <div class="section">
            <div class="form-group checkbox-group">
                <input type="checkbox" id="showFooterDate" name="showFooterDate" value="true" checked>
                <label for="showFooterDate">Exibir data no rodapé</label>
            </div>

            <div class="form-group">
                <label for="footerText">Texto no Rodapé:</label>
                <textarea id="footerText" name="footerText" rows="3" placeholder="Ex: Efetue agora o upload da documentação necessária através do Portal do Candidato."></textarea>
            </div>

            <div class="form-group">
                <label for="qrCodeUrl">URL para Link e QR Code do Rodapé:</label>
                <input type="url" id="qrCodeUrl" name="qrCodeUrl" placeholder="https://sistemas.utfpr.edu.br/...">
            </div>
        </div>

        <hr class="section-divider">

        <div class="section footer-actions">
            <div class="form-group">
                <label for="csvFile">Arquivo CSV:</label>
                <input type="file" id="csvFile" name="csvFile" accept=".csv" required>
            </div>
            <div>
                <button type="button" id="validateCsvBtn" class="btn btn-secondary">Verificar CSV</button>
                <button type="submit" class="btn">Gerar Relatório</button>
            </div>
        </div>

        <div id="validation-message-container" style="margin-top: 1em;">
        </div>
    </form>
</div>

<script th:src="@{/js/main.js}"></script>
</body>
</html>